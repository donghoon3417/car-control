<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>색깔 맞추기 자동차 게임</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #eef;
      font-family: sans-serif;
    }

    .car {
      width: 80px;
      height: 40px;
      position: absolute;
      transform-origin: center center;
      transition: transform 0.1s linear;
      cursor: pointer;
      border: 3px solid transparent;
    }

    .selected {
      border-color: black;
    }

    .goal {
      width: 100px;
      height: 100px;
      position: absolute;
      border: 3px dashed #333;
      border-radius: 10px;
    }

    #message {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 32px;
      color: green;
      display: none;
    }
  </style>
</head>
<body>

<div id="message">성공!</div>

<script>
  const screenWidth = window.innerWidth;
  const screenHeight = window.innerHeight;
  const margin = 20;
  const carW = 80, carH = 40;
  const speed = 3;

  const colors = ['red', 'blue', 'green'];
  const cars = [];
  const goals = [];
  let currentPlayerIndex = 0;
  const keysPressed = {};
  const arrived = new Set();

  // 도착지 만들기
  colors.forEach((color, i) => {
    const goal = document.createElement("div");
    goal.className = "goal";
    goal.style.backgroundColor = color;
    goal.style.left = `${screenWidth - 150}px`;
    goal.style.top = `${100 + i * 150}px`;
    document.body.appendChild(goal);
    goals.push({ color, el: goal });
  });

  // 자동차 생성
  colors.forEach((color, i) => {
    const car = document.createElement("div");
    car.className = "car";
    car.style.backgroundColor = color;
    car.style.left = `${100}px`;
    car.style.top = `${100 + i * 150}px`;
    document.body.appendChild(car);

    const carData = {
      el: car,
      color,
      x: 100,
      y: 100 + i * 150,
      vx: 0, vy: 0
    };

    car.addEventListener("click", () => {
      cars[currentPlayerIndex].el.classList.remove("selected");
      currentPlayerIndex = i;
      car.classList.add("selected");
    });

    cars.push(carData);
  });

  cars[currentPlayerIndex].el.classList.add("selected");

  // 키 입력 처리
  document.addEventListener("keydown", e => {
    keysPressed[e.key.toLowerCase()] = true;
  });
  document.addEventListener("keyup", e => {
    delete keysPressed[e.key.toLowerCase()];
  });

  function update() {
    const car = cars[currentPlayerIndex];

    let vx = 0, vy = 0;
    if (keysPressed['w']) vy -= 1;
    if (keysPressed['s']) vy += 1;
    if (keysPressed['a']) vx -= 1;
    if (keysPressed['d']) vx += 1;

    if (vx !== 0 && vy !== 0) {
      vx *= Math.SQRT1_2;
      vy *= Math.SQRT1_2;
    }

    car.vx = vx * speed;
    car.vy = vy * speed;
    car.x += car.vx;
    car.y += car.vy;

    // 화면 경계 처리
    car.x = Math.max(margin, Math.min(screenWidth - carW - margin, car.x));
    car.y = Math.max(margin, Math.min(screenHeight - carH - margin, car.y));

    car.el.style.left = `${car.x}px`;
    car.el.style.top = `${car.y}px`;

    // 목표지 도착 체크
    goals.forEach(goal => {
      if (car.color === goal.color && !arrived.has(car.color)) {
        const gx = goal.el.offsetLeft;
        const gy = goal.el.offsetTop;
        const gw = goal.el.offsetWidth;
        const gh = goal.el.offsetHeight;

        if (
          car.x + carW > gx &&
          car.x < gx + gw &&
          car.y + carH > gy &&
          car.y < gy + gh
        ) {
          arrived.add(car.color);
          if (arrived.size === colors.length) {
            document.getElementById("message").style.display = "block";
          }
        }
      }
    });

    requestAnimationFrame(update);
  }

  update();
</script>
</body>
</html>
