<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>자동차 제어 (후진 고정 모드)</title>
  <style>
    #car {
      width: 80px;
      height: 40px;
      position: absolute;
      top: 100px;
      left: 100px;
      transform-origin: center center;
      transition: transform 0.1s linear;
    }
  </style>
</head>
<body>
  <img id="car" src="car.png" alt="자동차" />

  <script>
    const car = document.getElementById("car");
    const carWidth = 80;
    const carHeight = 40;

    let x = 100;
    let y = 100;
    let angle = 0;
    let velocity = 0;
    const maxSpeed = 5;
    const acceleration = 0.1;
    const friction = 0.05;
    const turnSpeed = 2;

    let isReversed = false;

    const keys = {
      forward: false,
      backward: false,
      left: false,
      right: false
    };

    document.addEventListener("keydown", (e) => {
      switch (e.key.toLowerCase()) {
        case "d": keys.forward = true; break;
        case "a": keys.backward = true; break;
        case "w": keys.left = true; break;
        case "s": keys.right = true; break;
      }
    });

    document.addEventListener("keyup", (e) => {
      switch (e.key.toLowerCase()) {
        case "d": keys.forward = false; break;
        case "a": keys.backward = false; break;
        case "w": keys.left = false; break;
        case "s": keys.right = false; break;
      }
    });

    function update() {
      if (velocity !== 0) {
        if (keys.left) angle -= turnSpeed;
        if (keys.right) angle += turnSpeed;
      }

      if (keys.forward) {
        velocity += acceleration;
        isReversed = false;
      } else if (keys.backward) {
        velocity -= acceleration;
        isReversed = true;
      } else {
        if (velocity > 0) velocity = Math.max(0, velocity - friction);
        if (velocity < 0) velocity = Math.min(0, velocity + friction);
      }

      velocity = Math.max(-maxSpeed, Math.min(maxSpeed, velocity));

      const radians = angle * (Math.PI / 180);
      let nextX = x + Math.cos(radians) * velocity;
      let nextY = y + Math.sin(radians) * velocity;

      const halfWidth = carWidth / 2;
      const halfHeight = carHeight / 2;
      const maxX = window.innerWidth - halfWidth;
      const maxY = window.innerHeight - halfHeight;
      const minX = halfWidth;
      const minY = halfHeight;

      // 경계 안에 있을 때만 이동
      if (nextX >= minX && nextX <= maxX) x = nextX;
      if (nextY >= minY && nextY <= maxY) y = nextY;

      const flip = isReversed ? -1 : 1;

      car.style.left = `${x - halfWidth}px`;
      car.style.top = `${y - halfHeight}px`;
      car.style.transform = `rotate(${angle}deg) scaleX(${flip})`;

      requestAnimationFrame(update);
    }

    update();
  </script>
</body>
</html>
