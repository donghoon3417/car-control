<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Car Control Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #f0f0f0;
    }
    .car {
      width: 80px;
      height: 40px;
      position: absolute;
      transform-origin: center center;
      transition: transform 0.1s linear;
      cursor: pointer;
    }
    .selected {
      border: 2px solid red;
    }
  </style>
</head>
<body>

<script type="text/javascript">
  const carCount = 3;
  const aiCarCount = 3;
  const carsPerRow = 5;
  const totalCarCount = carCount + aiCarCount;

  const startX = 100;
  const startY = 100;
  const spacingX = 120;
  const spacingY = 120;

  const cars = [];
  let currentPlayerIndex = 0;

  const speed = 2;
  const screenWidth = window.innerWidth;
  const screenHeight = window.innerHeight;
  const carW = 80, carH = 40;
  const margin = 20;

  // ÏûêÎèôÏ∞® ÏÉùÏÑ±
  for (let i = 0; i < totalCarCount; i++) {
    const car = document.createElement("img");
    if (i < carCount) {
      car.src = `car${i + 1}.png`;
    } else {
      car.src = `car_ai.png`;
    }
    car.className = "car";

    const row = Math.floor(i / carsPerRow);
    const col = i % carsPerRow;
    const x = startX + col * spacingX;
    const y = startY + row * spacingY;

    car.style.left = `${x}px`;
    car.style.top = `${y}px`;
    document.body.appendChild(car);

    if (i < carCount) {
      car.addEventListener("click", () => {
        cars[currentPlayerIndex].el.classList.remove("selected");
        currentPlayerIndex = i;
        car.classList.add("selected");
      });
    }

    cars.push({
      el: car,
      x: x, y: y,
      angle: 0,
      vx: 0, vy: 0,
      isAI: i >= carCount
    });
  }

  cars[currentPlayerIndex].el.classList.add("selected");

  // AI Ïù¥Îèô
  setInterval(() => {
    cars.forEach(car => {
      if (car.isAI) {
        if (Math.random() < 0.3) {
          const dirs = [
            { vx: -1, vy: -1 }, { vx: 0, vy: -1 }, { vx: 1, vy: -1 },
            { vx: -1, vy: 0 }, { vx: 1, vy: 0 },
            { vx: -1, vy: 1 }, { vx: 0, vy: 1 }, { vx: 1, vy: 1 }
          ];
          const dir = dirs[Math.floor(Math.random() * dirs.length)];
          car.vx = dir.vx * speed;
          car.vy = dir.vy * speed;
        }

        car.x += car.vx;
        car.y += car.vy;

        if (car.x < margin || car.x > screenWidth - carW - margin) car.vx *= -1;
        if (car.y < margin || car.y > screenHeight - carH - margin) car.vy *= -1;

        car.el.style.left = `${car.x}px`;
        car.el.style.top = `${car.y}px`;
      }
    });
  }, 100);

  // ÌÇ§ ÏÉÅÌÉú Ï†ÄÏû•
  const keysPressed = {};

  document.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    keysPressed[k] = true;

    const car = cars[currentPlayerIndex];

    if (k === 'q') {
      car.angle -= 90;
      car.el.style.transform = `rotate(${car.angle}deg)`;
    }

    if (k === 'e') {
      car.angle += 180;
      car.el.style.transform = `rotate(${car.angle}deg)`;
    }
  });

  document.addEventListener("keyup", (e) => {
    delete keysPressed[e.key.toLowerCase()];
  });

 function update() {
  const car = cars[currentPlayerIndex];

  let vx = 0, vy = 0;
  if (keysPressed['w']) vy -= 1;
  if (keysPressed['s']) vy += 1;
  if (keysPressed['a']) vx -= 1;
  if (keysPressed['d']) vx += 1;

  if (vx !== 0 && vy !== 0) {
    vx *= Math.SQRT1_2;
    vy *= Math.SQRT1_2;
  }

  car.vx = vx * speed;
  car.vy = vy * speed;

  car.x += car.vx;
  car.y += car.vy;

  if (car.x < margin) car.x = margin;
  if (car.x > screenWidth - carW - margin) car.x = screenWidth - carW - margin;
  if (car.y < margin) car.y = margin;
  if (car.y > screenHeight - carH - margin) car.y = screenHeight - carH - margin;

  car.el.style.left = `${car.x}px`;
  car.el.style.top = `${car.y}px`;
  car.el.style.transform = `rotate(${car.angle}deg)`; // üî• Ï∂îÍ∞ÄÎêú Ï§Ñ

  requestAnimationFrame(update);
}

  update();
</script>

</body>
</html>
