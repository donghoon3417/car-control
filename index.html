<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>플레이어 선택 자동차 제어</title>
  <style>
    .car {
      width: 80px;
      height: 40px;
      position: absolute;
      transform-origin: center center;
      transition: transform 0.1s linear;
      border: 2px solid transparent;
    }
    .selected {
      border-color: red;
    }
  </style>
</head>
<body>
  <script>
    const carCount = 18;
    const carWidth = 80;
    const carHeight = 40;
    const screenWidth = 1980;
    const screenHeight = 1080;
    const padding = 20;
    const cars = [];

    let selectedCarIndex = 0;

    const keys = {
      forward: false,
      backward: false,
      left: false,
      right: false
    };

    // 자동차 생성
    for (let i = 0; i < carCount; i++) {
      const carEl = document.createElement("img");
      carEl.className = "car";
      carEl.src = `car${i + 1}.png`;
      carEl.alt = `자동차 ${i + 1}`;
      document.body.appendChild(carEl);

      const car = {
        el: carEl,
        x: Math.random() * (screenWidth - 2 * (carWidth + padding)) + carWidth + padding,
        y: Math.random() * (screenHeight - 2 * (carHeight + padding)) + carHeight + padding,
        angle: Math.random() * 360,
        velocity: 0,
        isReversed: false
      };

      // 클릭하면 선택
      carEl.addEventListener("click", () => {
        selectedCarIndex = i;
        updateCarSelection();
      });

      cars.push(car);
    }

    function updateCarSelection() {
      cars.forEach((car, index) => {
        car.el.classList.toggle("selected", index === selectedCarIndex);
      });
    }

    updateCarSelection();

    document.addEventListener("keydown", (e) => {
      const key = e.key.toLowerCase();

      if (e.shiftKey) {
        const keyMap = {
          "1": 0, "2": 1, "3": 2, "4": 3, "5": 4,
          "6": 5, "7": 6, "8": 7, "9": 8,
          "q": 9, "w": 10, "e": 11, "r": 12,
          "t": 13, "y": 14, "u": 15, "i": 16, "o": 17
        };
        if (key in keyMap) {
          selectedCarIndex = keyMap[key];
          updateCarSelection();
        }
        return;
      }

      // 조작키
      switch (key) {
        case "d": keys.forward = true; break;
        case "a": keys.backward = true; break;
        case "w": keys.left = true; break;
        case "s": keys.right = true; break;
      }
    });

    document.addEventListener("keyup", (e) => {
      switch (e.key.toLowerCase()) {
        case "d": keys.forward = false; break;
        case "a": keys.backward = false; break;
        case "w": keys.left = false; break;
        case "s": keys.right = false; break;
      }
    });

    function update() {
      cars.forEach((car, index) => {
        const el = car.el;

        const acceleration = 0.1;
        const friction = 0.05;
        const turnSpeed = 2;
        const maxSpeed = 5;

        if (index === selectedCarIndex) {
          if (car.velocity !== 0) {
            if (keys.left) car.angle -= turnSpeed;
            if (keys.right) car.angle += turnSpeed;
          }

          if (keys.forward) {
            car.velocity += acceleration;
            car.isReversed = false;
          } else if (keys.backward) {
            car.velocity -= acceleration;
            car.isReversed = true;
          } else {
            if (car.velocity > 0) car.velocity = Math.max(0, car.velocity - friction);
            if (car.velocity < 0) car.velocity = Math.min(0, car.velocity + friction);
          }

          car.velocity = Math.max(-maxSpeed, Math.min(maxSpeed, car.velocity));
        }

        const radians = car.angle * (Math.PI / 180);
        const nextX = car.x + Math.cos(radians) * car.velocity;
        const nextY = car.y + Math.sin(radians) * car.velocity;

        const halfW = carWidth / 2;
        const halfH = carHeight / 2;
        const minX = halfW + padding;
        const maxX = screenWidth - halfW - padding;
        const minY = halfH + padding;
        const maxY = screenHeight - halfH - padding;

        if (nextX >= minX && nextX <= maxX) car.x = nextX;
        if (nextY >= minY && nextY <= maxY) car.y = nextY;

        const flip = car.isReversed ? -1 : 1;

        el.style.left = `${car.x - halfW}px`;
        el.style.top = `${car.y - halfH}px`;
        el.style.transform = `rotate(${car.angle}deg) scaleX(${flip})`;
      });

      requestAnimationFrame(update);
    }

    update();
  </script>
</body>
</html>
